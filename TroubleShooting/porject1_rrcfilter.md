# Problem

## âš ï¸ë¬¸ì œ ìƒí™©: ê³ ì • ì†Œìˆ˜ì  Format ë³€í™˜

- í”„ë¡œì íŠ¸ì˜ ê²½ìš°
  - ëˆ„ì í•© Q8.16 --> Q1.8ë¡œ ë³€í™˜í•´ì•¼í–ˆìŒ
- ê³±ì…ˆê¸°ì—ì„œ ë§¤ë²ˆ Q1.8ë¡œ ë³€í™˜
 - multiplication ëª¨ë“ˆì— Q1.8ë¡œ ë³€í™˜í•˜ëŠ” ê³¼ì •ë„ í¬í•¨

## ğŸ¤”ë¬¸ì œ
- ê³±ì…ˆê¸°ê°€ 33ê°œê°€ ì‚¬ìš©ë¨
- ê·¸ëŸ¼ 33ë²ˆì˜ ë³€í™˜ê³¼ì •ì„ ê±°ì³ì•¼í•¨
- ê·¼ë° ë§ˆì§€ë§‰ ëˆ„ì í•©ì—ì„œ ë˜ ë³€í™˜ê³¼ì •ì„ ê±°ì³ì•¼í•¨
- ê·¸ëŸ¬ë©´ ë³€í™˜ê³¼ì • 34ë²ˆ í•´ì•¼í•¨
  - ë³€í™˜ê³¼ì • --> ì •ë°€ë„ ì €í•˜
  - ì—¬ëŸ¬ë²ˆ ê±°ì¹œë‹¤ --> ì •ë°€ë„ ì €í•˜ë„ â¬†ï¸
- âš ï¸ì½”ë“œ ë° íšŒë¡œë„ ë³µì¡í•´ì§€ê³  ì •ë°€ë„ë„ ì €í•˜ë¨


## ğŸš€í•´ê²°

- ë§ˆì§€ë§‰ ëˆ„ì í•©ì—ì„œë§Œ í¬ë§· ë³€í™˜ ìˆ˜í–‰
  - ë³€í™˜ 1ë²ˆë§Œ ìˆ˜í–‰
  - ì½”ë“œ ë° íšŒë¡œ ë³µì¡ë„ ê°ì†Œ
  - ì •ë°€ë„ ì €í•˜ìœ¨ ê°ì†Œ
    - ë³€í™˜ì„ í•œë²ˆë§Œ ìˆ˜í–‰í•˜ë‹ˆê¹Œ

## ğŸ‘¨â€ğŸ’»í•´ê²°ê³¼ì •

[ì†ŒìŠ¤ì½”ë“œ ì°¸ê³ :rrc_filter.sv](../project1/success/source_code/rrc_filter.sv)

- ì…ë ¥: Q1.8
- í•„í„° ê³„ìˆ˜: Q1.8
- ì¶œë ¥: Q1.8

### 1. ê³±ì…ˆê¸°
```verilog
module multiplier_9b #(
	parameter WIDTH = 9
)(
	input logic signed [WIDTH-1:0] mul_in,
	input logic signed [WIDTH-1:0] coefficient,

	output logic signed [2*WIDTH-1:0] mul_out
);
	
	assign mul_out = mul_in * coefficient;

endmodule
```

- Q1.8ì˜ ë‘ ìˆ˜ë¥¼ ê³±í•˜ë©´
  - Q2.16ì˜ ê²°ê³¼ê°€ ë‚˜ì˜¨ë‹¤
- ê·¸ëŸ¬ë©´ ì¶œë ¥ì€ 18bitê°€ ë˜ì•¼í•œë‹¤

### 2. Accumualate Sum

```verilog
	always_comb begin : accumulate_sum
		acc_sum = mul_sum[0] + mul_sum[1] + mul_sum[2] + mul_sum[3] + mul_sum[4] + 
		mul_sum[5] + mul_sum[6] + mul_sum[7] + mul_sum[8] + mul_sum[9] + 
		mul_sum[10] + mul_sum[11] + mul_sum[12] + mul_sum[13] + mul_sum[14] + 
		mul_sum[15] + mul_sum[16] + mul_sum[17] + mul_sum[18] + mul_sum[19] + 
		mul_sum[20] + mul_sum[21] + mul_sum[22] + mul_sum[23] + mul_sum[24] + 
		mul_sum[25] + mul_sum[26] + mul_sum[27] + mul_sum[28] + mul_sum[29] + 
		mul_sum[30] + mul_sum[31] + mul_sum[32];  
	end
```

- ê³±ì…ˆì˜ ê²°ê³¼: Q2.16
- Q2.16ì„ 33ê°œ ë”í•˜ë©´
  - ì •ìˆ˜ë¶€ ë¹„íŠ¸ìˆ˜ + $log_2(32)$
  - $2+log_2(32)=2+5=7$
  - Q7.16 + Q2.16(ë‚˜ë¨¸ì§€ í•œê°œ:mul_sum[32]) = Q8.16

### 3. Q1.8ë¡œ ë³€í™˜

### ì†Œìˆ˜ë¶€ - Truncation

```verilog
logic signed [15:0] trunc_frac_sum;
	assign trunc_frac_sum = acc_sum[23:8];
```

- ```trunc_frac_sum```: ì†Œìˆ˜ë¶€ ìµœí•˜ìœ„ 8ë¹„íŠ¸ë¥¼ ì˜ë¼ëƒ„
  - Q.16 --> Q.8
  - F[15:0] --> F[15:8]
  - truc_frac_sum = I[7:0].F[15:8]
  - 
///////////////////////////////////////////////////////////////////////
ì˜ëª»ëœ ë¶€ë¶„
///////////////////////////////////////////////////////////////////////
<!-- ### ì •ìˆ˜ë¶€ -  Saturation

```verilog
//ë³€í™˜í•  ì •ìˆ˜ë¶€ê°€ 1bitë¼ ê°€ëŠ¥í•¨
//ê¸°ì¡´ ì •ìˆ˜ë¶€ì˜ MSBë¡œë§Œ ê·¸ëŒ€ë¡œ ê°€ì ¸ì˜¬ ìˆ˜ ìˆìŒ
	always_ff @( posedge clk or posedge rst) begin : out_sum
		if(rst) begin
			filter_out <=0;
		end
		else if(trunc_frac_sum[15] == 0) begin
			filter_out <= {1'b0, trunc_frac_sum[7:0]};
		end
		else begin
			filter_out <= {1'b1, trunc_frac_sum[7:0]};
		end
	end
```

```verilog
//ì¼ë°˜ì ì¸ í¬ë§·
	always_ff @( posedge clk or posedge rst) begin : out_sum
		if(rst) begin
			filter_out <=0;
		end
		else if(trunc_frac_sum[15:7] > ë³€í™˜ì •ìˆ˜ë¶€_MAXê°’) begin
			filter_out[ì •ìˆ˜ë¶€] <= ë³€í™˜ì •ìˆ˜ë¶€_MAXê°’;
		end
		else if(trunc_frac_sum[15:7] < ë³€í™˜ì •ìˆ˜ë¶€_MIN) begin
			filter_out[ì •ìˆ˜ë¶€] <= ë³€í™˜ì •ìˆ˜ë¶€_MIN;
		end
		else begin
			filter_out <= ë³€í™˜ì „_ì •ìˆ˜ê°’;
		end
	end
```

- Q8.(ê¸°ì¡´)
  - ìˆ˜ì˜ í‘œí˜„ë²”ìœ„: -128~127
- Q1.(ë³€í™˜)
  - ìˆ˜ì˜ í‘œí˜„ë²”ìœ„: -1~0
- ê¸°ì¡´ ì •ìˆ˜ë¶€ì˜ ìˆ˜ì˜ í‘œí˜„ë²”ìœ„ê°€ ë³€í™˜í•  ì •ìˆ˜ë¶€ì˜ ìˆ˜ì˜ ë²”ìœ„ë¥¼ ë²—ì–´ë‚˜ëŠ” ê²½ìš°
  - ê¸°ì¡´ ì •ìˆ˜ë¶€ > 0
    - ë³€í™˜ ì •ìˆ˜ë¶€ëŠ” 0ìœ¼ë¡œ Saturation
  - ê¸°ì¡´ ì •ìˆ˜ë¶€ < -1
    - ë³€í™˜ ì •ìˆ˜ë¶€ëŠ” 1ë¡œ saturation

### ë‚´ ê²½í—˜ìƒ ì¶”ì²œ ë³€í™˜ ë°©ë²•

- ì†Œìˆ˜ë¶€ë¥¼ ë¨¼ì € ë³€í™˜í•´ì£¼ê³ 
- ê·¸ë‹¤ìŒì— ì •ìˆ˜ë¶€ë§Œ saturationí•´ì£¼ëŠ”ê²Œ ì´í•´ì™€ ì—°ì‚°ì´ í¸í•¨
- ì˜ˆë¥¼ ë“¤ì–´, 011.1010[2ì§„ìˆ˜: 3.625 Q3.4]ë¥¼ Q2.2ë¡œ ë³€í™˜í•œë‹¤ê³  í•˜ë©´
  - ì†Œìˆ˜ë¶€ ë¨¼ì €
    - .1010 --> .10ìœ¼ë¡œ truncation
    - 0.625 --> 0.5
      - ë¹„íŠ¸ë¡œ í‘œí˜„ê°€ëŠ¥í•œ ì†Œìˆ˜ì—ì„œ ì œì¼ ê°€ê¹Œìš´ ìˆ˜ë¡œ ë³€í™˜ ê°€ëŠ¥
  - ì •ìˆ˜ë¶€
    - 011.: 3
    - Q2.ê°€ í‘œí˜„í•  ìˆ˜ ìˆëŠ” ì •ìˆ˜ ë²”ìœ„: -2~1
    - ìˆ˜ì˜ ë²”ìœ„ë¥¼ ë²—ì–´ë‚¨
    - ë³€í™˜í•  ì •ìˆ˜ë¶€ê°€ í‘œí˜„í•  ìˆ˜ ìˆëŠ” ìµœëŒ€ ë²”ìœ„ë¡œ í‘œí˜„
    - ì–‘ìˆ˜ë‹ˆê¹Œ MSB = 0
    - ë”°ë¼ì„œ 0(MSB)1(ìµœëŒ€ ì •ìˆ˜ ë²”ìœ„)
 --><br>

///////////////////////////////////////////////////////////////////////


âš ï¸ì´ë ‡ê²Œ í•˜ë©´ ì•ˆë¨ --> ë‚´ê°€ ì˜ëª» ì´í•´í•œê±°ì„
---

# ë‚´ê°€ ì˜ëª» ì´í•´í•˜ê³  ì˜ëª» ì„¤ê³„í•œ ì½”ë“œ

```verilog
	always_ff @( posedge clk or posedge rst) begin : out_sum
		if(rst) begin
			filter_out <=0;
		end
		else if(trunc_frac_sum[15] == 0) begin
			filter_out <= {1'b0, trunc_frac_sum[7:0]};
		end
		else begin
			filter_out <= {1'b1, trunc_frac_sum[7:0]};
		end
	end
```

- ì§€ê¸ˆ ì •ìˆ˜ë¶€ë§Œ í¬í™”ì‹œí‚´
  - ì†Œìˆ˜ë¶€ëŠ” í¬í™” ì•ˆë¨
  - ì˜ˆë¥¼ ë“¤ì–´, 127.123456ì„ ì •ìˆ˜ 1ìë¦¬, ì†Œìˆ˜ 3ìë¦¬ë¡œ ë°”ê¾¼ë‹¤ë©´
  - ë‚˜ì˜ ê²½ìš°(error): 9.123 --> ì†Œìˆ˜ë¶€ í¬í™”ê°€ ì•ˆë¨ --> 9.999ê°€ ì •ìƒ ë³€í™˜ê°’ì„

# ìˆ˜ì •í•œ ì½”ë“œ

â­HW ì•ˆì—ì„œ ì—°ì‚°ì„ í•  ë•ŒëŠ” integerí˜•ì‹ì„ì„ ì¸ì§€í•˜ê³  ì—°ì‚°ì„ ìˆ˜í–‰í•˜ì --> ì†Œìˆ˜ëŠ” ë‚˜ì¤‘ì— 2^(ì†Œìˆ˜ë¹„íŠ¸)ë¡œ ë‚˜ëˆ ì£¼ë©´ë¨
---
> ì •ìˆ˜ë¡œ ì—°ì‚°ì„ ìˆ˜í–‰í•˜ì

```verilog
	always_ff @( posedge clk or posedge rst ) begin : blockName
		if(rst) begin
			filter_out <= 0;
		end
		// trunc_frac_sum: Q8.8  -- ì¶œë ¥ Q1.8 : -256~255
		else if(trunc_frac_sum > 255) begin
			filter_out <= 255;
		end
		else if(trunc_frac_sum < -256) begin
			filter_out <= -256;
		end
		else begin
			filter_out <= trunc_frac_sum;
		end
	end
```
- ì†Œìˆ˜ë¶€ë¥¼ Truncationí•˜ê³  Q8.8ì¸ ìƒíƒœ --> trunc_frac_sum
- ë³€í™˜í•´ì•¼ë  ì¶œë ¥ Q1.8: filter_out --> ê°’ì˜ í‘œí˜„ë²”ìœ„ = -256~255
  - ```trunc_frac_sum``` > 255ë³´ë‹¤ í¬ë©´
    - ì¶œë ¥ ```filter_out```ì„ 255ë¡œ Saturation
  - ```trunc_frac_sum``` < -256ë³´ë‹¤ ì‘ìœ¼ë©´
    - ì¶œë ¥ ```filter_out```ì„ -256ìœ¼ë¡œ Saturation

## âš ï¸ì£¼ì˜í•  ì‚¬í•­(ê¹¨ë‹¬ì€ ì )
- íšŒë¡œ ì•ˆì—ì„œ ì—°ì‚°í•  ë•ŒëŠ” ì •ìˆ˜ë¡œì„œ ì—°ì‚°ì„ ìˆ˜í–‰í•˜ì
  - ì •ìˆ˜ë¶€, ì†Œìˆ˜ë¶€ ë”°ë¡œ ë‚˜ëˆ ì„œ ìƒê°X
  - ì†Œìˆ˜ë¶€ë¥¼ Truncationí•  ë•Œë§Œ ê³ ë ¤
- ì†Œìˆ˜ë¶€ë¥¼ ë¨¼ì € Truncationì„ í•˜ê³ 
  - ì´í›„ ë³€í™˜í•  ê°’ì˜ ë¹„íŠ¸ ë²”ìœ„ë¥¼ ë²—ì–´ë‚˜ëŠ”ì§€ í™•ì¸

## ì°¸ê³ ) ì†Œìˆ˜ë¶€ ìë¦¬ìˆ˜ì™€ Truncation
- ì†Œìˆ˜ë¶€ ì´í•˜ 2ë¹„íŠ¸, 1ë¹„íŠ¸ë¡œ ì¤„ì´ëŠ” ê·¹ë‹¨ì  ê²½ìš°
  - í˜„ì‹¤ì—ì„  ê±°ì˜ ì—†ìŒ
- ë”°ë¼ì„œ ëŒ€ë¶€ë¶„ truncationí•˜ëŠ” ê²½ìš° Truncationë˜ëŠ” ì†Œìˆ˜ì˜ ê°’ì´ ë§¤ìš° ì‘ìŒ
  - ëŒ€ë¶€ë¶„ì˜ ê²½ìš° truncationí•˜ëŠ” ê²½ìš° ê°’ì˜ ì˜¤ì°¨ê°€ ê·¸ë¦¬ í¬ì§€ì•ŠìŒ
- íŠ¹ë³„í•œ caseê°€ ì•„ë‹Œ ê²½ìš° roundì™€ truncationì˜ ì„±ëŠ¥ ì°¨ì´ê°€ ê±°ì˜ ì—†ë‹¤
  - **êµìˆ˜ë‹˜ í”¼ì…œì„**
